language: android
jdk: oraclejdk8
env:
  global:
  - secure: E8yzFcJx4YZjwh8RLDm2cwb9uwZ5MHy6kMXu1Vdd66FFgbfGBk667H+MNSFmVqYYSWfhxq0N+ipz16fdKJ30SRwM/M6B8J4iqqBcblw1FYLYaF+ved4NxNa9vakeTW6X/uTCvy2W/AYo6J1dhvMuoP6eTiFoEEHpsOoWCMZRmaYUYazBJVFvLqJ+goyAs9YJncDklMulydhVljR1ivXIfyAL7qcbUhuRBZhDQJ8OPN8RURStp4GucTwiUZ06nLSXFG6ai343OULgputRfDtff/u6K8Qld4QusVTXbyYPv2rDDnp2J5cW2DB7Bid6CoC9ufMDGNXiAoc8efcrxKtM74xv+WPkfR1rMJ1fi0O5sCk/lma6y7J/49GbTwRvybZUMLLyi0HkFDg8u04rWXvg/lNOudHFwxi30b9rVxw25Wj2nh/wdW0ADzW/Lt7MxhhtiktmaW0/kivRczDZ59GaDzqepScMlsDglvIDH3XtiML0Vi5HUzIynxptxvNYM19fZFRHiYHRHvwNoPnram7Uz0ejqFA/K3lNQH02XAJjcycvnYIprEu0qT1QHgJwc0g/HLAJ08/DwK1NnWP1rURtfdyZeq8zavop4+ztbthEBHrc37Qfm/4NmlcHbnPoEllxRPWGz1WQwN+ty41/Caj1Fk6BdyNf0DnGPSghAZKVJJs=
  - secure: nYL/zlK+tdKBrQKN3SLQ8uy5igk6ucspu7KrDZGL3hQI+W3sAVOsH/xC3ZNO8wqgaZiH98xAGJUEQDKpUmHECkI3XOewzDT+fS3jSLFjnr3XU6yceqcS7EuH850wX5cQaKy4jkppvc9YL21MGiaW4cOkDrdW+7+ITURRkSuTAMJP2AWcJNX7bwrrjZkQgMWzvbLUnfSsgQSCPuKKalxqK8fI6nfTMFFezHYmdH0sIoIb42u+2epZOqmxluWdE7l5I4f7o8/KUujJzuux51l+Dt5SJLj9bZ8vSfR37eHujkxRNEwwhQlhWNbN88FadmzNUXJYg1F6Ep2PEZLBUYq7YQpHyY9PIsPbEgOIbLuCjKxLHZZZSVMmOR/7YWS60j40bBBs2QeTFbihspF7V06n5QO+e3vxRSCrYTE7/8NU1Ap59ffUbCD+P/Ko4Ad0S4o1ikEVpFJGMwlv9Tx8hyia/EwVepelWLw6Yh0qh3j+Vkx915rHLmNaFz68sNv/ozF7pn/rzPZr2T5RKqn5+fsGCElycJXAe+pb/GeRj0MbvGOza2dpmwGQU1qJOwxXpbl9PLfzzpETMHb7zXEI/li8lOW1skgve6hTrGQLFRau1Bw3yVQ/iBfyBRIFnaMNZSm8+HviXusTvo5TFwPQhuJPxRyvwaGKlNhOH0sFNoNmQu4=
android:
  components:
  - platform-tools
  - tools
  - build-tools-25.0.3
  - android-22
  - android-25
  - sys-img-armeabi-v7a-android-22
  - extra-android-m2repository
licenses:
- android-sdk-preview-license-.+
- android-sdk-license-.+
before_install:
- openssl aes-256-cbc -K $encrypted_be1ae8b65885_key -iv $encrypted_be1ae8b65885_iv
  -in keystore.jks.enc -out keystore.jks -d
- mkdir "$ANDROID_HOME/licenses" || true
- echo -e "\n8933bad161af4178b1185d1a37fbf41ea5269c55" > "$ANDROID_HOME/licenses/android-sdk-license"
- echo -e "\n84831b9409646a918e30573bab4c9c91346d8abd" > "$ANDROID_HOME/licenses/android-sdk-preview-license"
before_script:
- echo no | android create avd --force -n test -t android-22 --abi armeabi-v7a
- emulator -avd test -no-audio -no-window &
- android-wait-for-emulator
- adb shell input keyevent 82 &
script:
- cd app/
- "../gradlew build connectedCheck"
- cd ../
before_cache:
- rm -f  $HOME/.gradle/caches/modules-2/modules-2.lock
- rm -rf $HOME/.gradle/caches/*/plugin-resolution/
cache:
  directories:
  - "$HOME/.gradle/caches/"
  - "$HOME/.gradle/wrapper/"
  - "$HOME/.android/build-cache"
before_deploy:
  - cp $TRAVIS_BUILD_DIR/keystore.jks $HOME
  - cd app/build/outputs/apk/
  - jarsigner -verbose -sigalg SHA1withRSA -digestalg SHA1 -keystore $HOME/keystore.jks -storepass $storepass -keypass $keypass app-release-unsigned.apk GrouvieKeystore

  - jarsigner -verify app-release-unsigned.apk
  - "${ANDROID_HOME}/build-tools/24.0.2/zipalign -v 4 app-release-unsigned.apk Grouvie.apk"
deploy:
  provider: releases
  file: Grouvie.apk
  skip_cleanup: true
  on:
    repo: T-Khanna/Grouvie
    tags: true
    jdk: oraclejdk8
  api_key:
      secure: "UVhpedkzodRdZDlyPM2xtHGezqTTPyPKE5KIh4owylw66STRRhEtmUWrUUKBDD8Vvsg/vfOw5qEvGa29Ac3LZA05Ka+MztYUV04IJiBHu6sliHjhkAuo/X364JYjZA4up7rgFxe/0KqA4TsNpz+jeg6l217cLH+CJ
ljF9nGUPEh8uHMY6QjFYD4ZMFxPfelyTlsVW+Kvr+8KxZP6/aLIRoeGBZnsS78xBD60kbot7dXCEs8cZDq4A512DASd95993IzuBeMob6bnPj3K82ktR4CnOrmtdUgRxe+X1KNlgd5MKYPk/X7OsAbOPpsklqHf5TRoHm2Kd2gNJ
qEvrBa5Lwug558NFtLLWK/0n4XO4oTyLHxjpm9FXKMZezAMMERcKI6rMrP7+PVbABscqyOLL6jCVlnXatGK+r6Kv6ftahKcsX0EvJUuKsCPLQVxHOKVqBIl2aKG2PLTeZ98Y1xbl3CgtzuvHWGIOCNZ8zXwMJO1UdEknX4c3LDab
rdrQnzCMlvojwyGUpZ+OZ9BGrmzL9oypzvep2NGG33onz9l02QwJ2RVV3dem/MxL1zu8+tP2BswGBSF7rrjlsZpOTa3etAfnM+h6AbndiDFz+LPxcUbkJI9WPxCQSYuPhZnffW2M3mzynCN+goaXdSZ1oulprGN3YhQqaI+Y4iOU
EG+UG4="
